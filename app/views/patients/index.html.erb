<div class="patients-index">
  <div class="patients-header">
    <div class="header-content">
      <h1 class="page-title">Gesti√≥n de Pacientes</h1>
      <p class="page-subtitle">Administra la informaci√≥n de todos tus pacientes</p>
    </div>
    <div class="header-actions">
      <%= link_to new_patient_path, class: "btn btn-primary" do %>
        <span class="btn-icon">‚ûï</span>
        Agregar Paciente
      <% end %>
    </div>
  </div>

  <!-- Filtros y B√∫squeda -->
  <div class="filters-section">
    <%= form_with url: patients_path, method: :get, local: true, class: "filters-form" do |f| %>
      <div class="filters-grid">
        <div class="filter-group">
          <%= f.text_field :search, placeholder: "Buscar por nombre, email o tel√©fono...", 
                          value: params[:search], class: "form-control search-input" %>
        </div>
        
        <div class="filter-group">
          <%= f.select :city, options_for_select([['Todas las ciudades', '']] + @cities.map { |city| [city, city] }, params[:city]), 
                      {}, { class: "form-control" } %>
        </div>
        
        <div class="filter-group">
          <%= f.select :state, options_for_select([['Todos los estados', '']] + @states.map { |state| [state, state] }, params[:state]), 
                      {}, { class: "form-control" } %>
        </div>
        
        <div class="filter-group">
          <%= f.select :status, options_for_select([
            ['Todos los estados', ''],
            ['Solo activos', 'active'],
            ['Solo inactivos', 'inactive']
          ], params[:status]), {}, { class: "form-control" } %>
        </div>
        
        <div class="filter-group">
          <%= f.select :sort, options_for_select([
            ['Nombre A-Z', 'name_asc'],
            ['Nombre Z-A', 'name_desc'],
            ['Email A-Z', 'email_asc'],
            ['Email Z-A', 'email_desc'],
            ['M√°s recientes', 'created_desc'],
            ['M√°s antiguos', 'created_asc'],
            ['M√°s j√≥venes', 'age_asc'],
            ['M√°s mayores', 'age_desc']
          ], params[:sort] || 'name_asc'), {}, { class: "form-control" } %>
        </div>
        
        <div class="filter-actions">
          <%= f.submit "Filtrar", class: "btn btn-secondary" %>
          <%= link_to "Limpiar", patients_path, class: "btn btn-outline" %>
        </div>
      </div>
    <% end %>
  </div>

  <!-- Estad√≠sticas -->
  <div class="patients-stats">
    <div class="stat-item">
      <span class="stat-number"><%= @patients.count %></span>
      <span class="stat-label">Pacientes Encontrados</span>
    </div>
    <div class="stat-item">
      <span class="stat-number"><%= Patient.active.count %></span>
      <span class="stat-label">Pacientes Activos</span>
    </div>
    <div class="stat-item">
      <span class="stat-number"><%= Patient.inactive.count %></span>
      <span class="stat-label">Pacientes Inactivos</span>
    </div>
  </div>

  <!-- Tabla de Pacientes -->
  <div class="patients-table-container">
    <% if @patients.any? %>
      <table class="patients-table">
        <thead>
          <tr>
            <th>Nombre Completo</th>
            <th>Email</th>
            <th>Tel√©fono</th>
            <th>Edad</th>
            <th>Ciudad</th>
            <th>Estado</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <% @patients.each do |patient| %>
            <tr class="patient-row <%= 'inactive' unless patient.active? %>">
              <td class="patient-name">
                <div class="name-container">
                  <strong><%= patient.full_name %></strong>
                  <span class="status-badge <%= patient.active? ? 'active' : 'inactive' %>">
                    <%= patient.status_text %>
                  </span>
                </div>
              </td>
              <td class="patient-email">
                <%= mail_to patient.email, patient.email, class: "email-link" %>
              </td>
              <td class="patient-phone">
                <%= link_to patient.formatted_phone, "tel:#{patient.phone}", class: "phone-link" %>
              </td>
              <td class="patient-age">
                <% if patient.age %>
                  <%= patient.age %> a√±os
                <% else %>
                  <span class="text-muted">N/A</span>
                <% end %>
              </td>
              <td class="patient-city"><%= patient.city %></td>
              <td class="patient-state"><%= patient.state %></td>
              <td class="patient-actions">
                <div class="action-buttons">
                  <%= link_to patient_path(patient), class: "btn-action btn-view", title: "Ver detalles" do %>
                    üëÅÔ∏è
                  <% end %>
                  <%= link_to edit_patient_path(patient), class: "btn-action btn-edit", title: "Editar" do %>
                    ‚úèÔ∏è
                  <% end %>
                  <%= link_to toggle_status_patient_path(patient), method: :post, 
                              class: "btn-action btn-toggle", 
                              title: patient.active? ? "Desactivar" : "Activar",
                              data: { confirm: "¬øEst√°s seguro de cambiar el estado de este paciente?" } do %>
                    <%= patient.active? ? "‚è∏Ô∏è" : "‚ñ∂Ô∏è" %>
                  <% end %>
                  <%= link_to patient_path(patient), method: :delete, 
                              class: "btn-action btn-delete", title: "Eliminar",
                              data: { confirm: "¬øEst√°s seguro de eliminar este paciente? Esta acci√≥n no se puede deshacer." } do %>
                    üóëÔ∏è
                  <% end %>
                </div>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>

      <!-- Paginaci√≥n -->
      <div class="pagination-container">
        <%= paginate @patients %>
      </div>
      
      <div class="pagination-info">
        Mostrando <%= page_entries_info @patients, entry_name: 'paciente' %>
      </div>
    <% else %>
      <div class="empty-state">
        <div class="empty-icon">üë•</div>
        <h3>No se encontraron pacientes</h3>
        <p>
          <% if params[:search].present? || params[:city].present? || params[:state].present? || params[:status].present? %>
            No hay pacientes que coincidan con los filtros aplicados.
            <%= link_to "Limpiar filtros", patients_path, class: "btn btn-outline" %>
          <% else %>
            A√∫n no tienes pacientes registrados.
            <%= link_to "Agregar el primer paciente", new_patient_path, class: "btn btn-primary" %>
          <% end %>
        </p>
      </div>
    <% end %>
  </div>
</div>